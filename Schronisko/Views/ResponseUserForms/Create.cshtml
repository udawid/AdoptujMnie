@*@model Schronisko.Models.ResponseUserForm*@
@using Schronisko.Models
@model dynamic

@{
    ViewData["Title"] = "Create";
}

@{
    var userForm = (UserForm)ViewBag.userForm;
}

<h1>Zapraszamy do wypełnienia ankiety.</h1>

<h4>@userForm.Title</h4>
<hr />

<table class="table table-striped table-bordered">
@*    <thead>
        <tr>
            <th scope="col">Question Id</th>
            <th scope="col">Question</th>
        </tr>
    </thead>*@
    <tbody>
        @{
            int c = 0;
            //int i = 0;
        }
        @foreach (var item in userForm.Questions.OrderBy(q => q.QuestionOrder))
        {
            <tr>
                <th scope="row">
                    @{
                        ++c;
                    }
                    @c
                </th>
                <td>@item.QuestionText</td>
                <td>
                    @if (item.QuestionType.Name == "Tak / Nie" || item.QuestionType.Name == "Tak/Nie" || item.QuestionType.Name == "Wybierz jedną opcją")
                    {
                        foreach (var option in item.Options.OrderBy(o => o.OptionOrder))
                        {
                            @Html.RadioButton(@item.UserFormQuestionID.ToString(), @option.UserFormQuestionOptionID, new { @style =     "marginleft:5px;",id=@option.UserFormQuestionOptionID })
                            @Html.Label(@option.UserFormQuestionOptionID.ToString(), @option.OptionText)
                        }
                        <br />
                    }
                    else if (item.QuestionType.Name == "Wybierz wiele opcji")
                    {
                        foreach (var option in item.Options.OrderBy(o => o.OptionOrder))
                        {
                                <label style="margin-left: 5px;">
                                <input type="checkbox" name="dropdown-group" id=@option.UserFormQuestionOptionID value=@option.OptionText />
                                @option.OptionText
                                </label>
                        }
                        <br />
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
<input style="margin: 15px;" type="submit" value="Wyślij" onclick="send()" class="btn btn-success" />

<script type="text/javascript">
    let postData = {};
    function send() {
        var checkbox = document.querySelectorAll('input[type="checkbox"]');
        var radio = document.querySelectorAll('input[type="radio"]');
        let a = Array.from(checkbox);
        let b = Array.from(radio);
        a = a.filter((x) => x.checked);
        b = b.filter((x) => x.checked);
        let ids = [].concat(a.map(x => x.id), b.map(x => x.id));
        let values = [].concat(a.map(x => x.value), b.map(x => x.value));
        postData.ids = ids;
        postData.values = values;
        postData.userFormID = @ViewBag.userForm.UserFormID;
        $.ajax({
            type: 'POST',
            url: '@Url.Action("Create","ResponseUserForms")',
            //data: postData,
            data: {
                ids: postData.ids,
                values: postData.values,
                userFormID: postData.userFormID
            },
            success: function (response) {
                if (response.result == 'Redirect')
                    window.location = response.url;
            },
            dataType: 'json',
            traditional: true,
        });
        postData = {};
    }
</script>